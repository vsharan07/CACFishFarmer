<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Saved Farms</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, sans-serif;
  background: url('https://image2url.com/images/1761782922441-d06702be-22c8-474d-b4cb-70f8cff26c8d.png') no-repeat center center fixed;
  background-size: cover;
  margin: 0;
  padding: 30px 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh; 
}

h1 {
  color: #004e64;
  margin-bottom: 25px;
  font-size: 3.5em;
  letter-spacing: 1px;
  font-weight: bold;
  text-shadow: 0 0 8px #a8e0ff;
}

.farm-card {
  background: linear-gradient(135deg, #f0faff, #d0f0ff);
  width: 420px;
  height: 160px;
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 18px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.12);
  position: relative;
  display: flex;
  flex-direction: column;
}

.farm-name {
  font-size: 2.6em;
  font-weight: bold;
  color: #004e64;
  position: absolute;
  top: 35px;
  left: 55px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.rename-btn {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
  display: flex;
  align-items: center;
  height: 27px;
  transition: transform 0.3s ease;
}

.rename-btn img {
  width: 20px;
  height: 27px;
  object-fit: contain;
  position: relative;
  top: -3px;
}

.rename-btn:hover { transform: scale(1.05); }

.buttons {
  display: flex;
  gap: 12px;
  position: absolute;
  bottom: 10px;
  right: 15px;
}

.btn, .edit-btn, .add-btn, .back-button {
  font-family: 'Segoe UI', Tahoma, sans-serif;
  font-weight: 700;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 0 12px rgba(0,0,0,0.2);
  padding: 10px 16px;
  font-size: 16px;
  height: 42px; 
  display: flex;
  align-items: center;
  justify-content: center;
}

.btn.trash {
  background-color: #d62828;
  color: white;
  font-weight: bold;
  width: 50px;
  overflow: hidden;
}
.btn.trash::before {
  content: attr(data-text);
  display: inline-block;
  transition: all 0.3s ease;
  transform: translateX(-2px);
}
.btn.trash:hover {
  width: 100px;
}
.btn.trash:hover::before {
  content: "Delete";
}

.btn.view, .add-btn, .edit-btn {
  background: linear-gradient(90deg, #00b4d8, #0096c7);
  color: white;
  box-shadow: 0 0 12px rgba(0,180,216,0.5);
}
.btn.view:hover, .add-btn:hover, .edit-btn:hover {
  background: linear-gradient(90deg, #0096c7, #0077b6);
  transform: scale(1.05);
  box-shadow: 0 0 18px rgba(0,180,216,0.8);
}

.back-button {
  background-color: #555;
  color: white;
  box-shadow: 0 0 8px rgba(0,0,0,0.2);
}
.back-button:hover {
  background-color: #333;
  transform: scale(1.05);
  box-shadow: 0 0 12px rgba(0,0,0,0.3);
}

.action-buttons {
  width: 420px;
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
}

.add-btn, .back-button {
  flex: 1;
  margin: 0 7px;
}

.no-farms {
  font-size: 2em;
  font-weight: bold;
  color: #004e64;
  margin-top: 50px;
  text-align: center;
}

.modal-overlay {
  position: fixed;
  top:0;
  left:0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.confirm-modal {
  background: #fff;
  padding: 25px 35px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
  font-size: 1.4em;
  color: #333;
}

.confirm-modal button {
  margin: 15px 10px 0 10px;
  padding: 10px 20px;
  font-size: 1em;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  transition: 0.2s ease;
}

.confirm-modal .confirm-btn {
  background-color: #d62828;
  color: white;
}

.confirm-modal .cancel-btn {
  background-color: #555;
  color: white;
}

.confirm-modal button:hover { opacity: 0.85; }

.view-modal {
  width: 380px;
  max-width: 90%;
  background: linear-gradient(135deg,#f0f8ff,#e0f7fa);
  padding: 20px 25px 40px 25px;
  border-radius: 20px;
  position: relative;
  box-shadow: 0 15px 35px rgba(0,0,0,0.25);
  transform: scale(0.8);
  opacity: 0;
  transition: all 0.25s ease-out;
}

.modal-overlay.show .view-modal {
  transform: scale(1);
  opacity: 1;
}

.view-modal h2 {
  text-align: center;
  margin-bottom: 15px;
  color: #004e64;
  font-size: 1.8em;
  font-weight: bold;
}

.stats-box {
  background-color: #ffffffcc;
  padding: 10px 15px;
  border-radius: 12px;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.1);
  margin-bottom: 30px;
}

.stats-box p {
  display: flex;
  justify-content: space-between;
  margin: 6px 0;
  font-weight: 600;
  color: #003049;
  font-size: 0.95em;
}

.stats-box span {
  color: #0077b6;
  font-weight: bold;
  opacity: 0.3;
}

.stats-box input {
  width: 60px;
  font-size: 0.95em;
  font-weight: 600;
  font-family: 'Segoe UI', Tahoma, sans-serif;
  text-align: right;
  border: 1px solid #0077b6;
  border-radius: 4px;
  padding: 2px 4px;
  opacity: 1;
}

.exit-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  background: none;
  border: none;
  font-size: 2em;
  font-weight: bold;
  cursor: pointer;
  color: #d62828;
  line-height: 1;
}

.exit-btn:hover {
  color: #ff4d4d;
}

@media(max-width:600px){
  .farm-card,.action-buttons{width:90%;}
  .buttons{position:static;margin-top:auto;justify-content:flex-end;}
  .action-buttons{flex-direction:column;gap:12px;}
  .add-btn,.back-button{margin:0;width:100%;}
  .farm-name{position:static;margin-bottom:10px;font-size:2.6em;gap:5px;}
  .rename-btn img{top:0;}
  .edit-btn{margin:15px 0 0 auto;}
}
</style>
</head>
<body>

<h1>Saved Farms</h1>
<div id="farm-container"></div>

<div class="action-buttons">
  <button class="back-button btn" onclick="location.href='1Home.html'">Back</button>
  <button class="add-btn btn" onclick="addFarm()">+ Add</button>
</div>

<div class="modal-overlay" id="deleteModal">
  <div class="confirm-modal">
    <div>Are you sure?</div>
    <button class="confirm-btn" id="confirmDelete">Yes</button>
    <button class="cancel-btn" id="cancelDelete">No</button>
  </div>
</div>

<div class="modal-overlay" id="exitModal" style="z-index:3000;">
  <div class="confirm-modal">
    <div>Exit without saving changes?</div>
    <button class="confirm-btn" id="confirmExit">Yes</button>
    <button class="cancel-btn" id="cancelExit">No</button>
  </div>
</div>

<div class="modal-overlay" id="viewModal">
  <div class="modal view-modal">
    <button class="exit-btn" id="exitButton">&times;</button>
    <h2 id="viewFarmName">Farm</h2>
    <div class="stats-box">
      <p>Algae (cells/L): <span id="statAlgae">N/A</span></p>
      <p>pH Value (0-14): <span id="statPH">N/A</span></p>
      <p>Dissolved Oxygen (mg/L): <span id="statDO">N/A</span></p>
      <p>Salinity (ppt): <span id="statSalinity">N/A</span></p>
      <p>Bacterial Load (CFU/mL): <span id="statBacteria">N/A</span></p>
    </div>
    <button class="edit-btn" id="editBtn">Edit</button>
  </div>
</div>

<script>
let farms = JSON.parse(localStorage.getItem('farms')) || [];
let farmToDelete = null;
let editing = false;
let prevValues = {};
let currentFarmIndex = null;

function saveToStorage(){ localStorage.setItem('farms', JSON.stringify(farms)); }

function renderFarms(){
  const container = document.getElementById('farm-container');
  container.innerHTML='';
  if(farms.length===0){
    const msg=document.createElement('div');
    msg.className='no-farms';
    msg.innerHTML='No farms :(<br>Add a new one?';
    container.appendChild(msg);
    return;
  }
  farms.forEach((farm,index)=>{
    const card=document.createElement('div');
    card.className='farm-card';
    card.innerHTML=`
      <div class="farm-name">
        <span class="name-text">${farm.name}</span>
        <button class="rename-btn"><img src="https://cdn-icons-png.flaticon.com/512/6325/6325975.png" alt="Rename"></button>
      </div>
      <div class="buttons">
        <button class="btn trash" data-text="🗑️"></button>
        <button class="btn view">View</button>
      </div>
    `;
    container.appendChild(card);

    card.querySelector('.rename-btn').addEventListener('click',()=>{
      const newName=prompt("Enter new farm name:",farm.name);
      if(newName && newName.trim()!==""){ farm.name=newName.trim(); card.querySelector('.name-text').textContent=farm.name; saveToStorage(); }
    });

    card.querySelector('.trash').addEventListener('click',()=>{
      farmToDelete=index;
      document.getElementById('deleteModal').style.display='flex';
    });

    card.querySelector('.view').addEventListener('click',()=>{
      currentFarmIndex=index;
      openViewModal(farm);
    });
  });
}

document.getElementById('confirmDelete').addEventListener('click',()=>{
  if(farmToDelete!==null){ farms.splice(farmToDelete,1); saveToStorage(); farmToDelete=null; renderFarms(); }
  document.getElementById('deleteModal').style.display='none';
});
document.getElementById('cancelDelete').addEventListener('click',()=>{ farmToDelete=null; document.getElementById('deleteModal').style.display='none'; });

function addFarm(){ const newFarm={name:`Farm ${farms.length+1}`,algae:'N/A',ph:'N/A',do:'N/A',salinity:'N/A',bacteria:'N/A'}; farms.push(newFarm); saveToStorage(); renderFarms(); }

function openViewModal(farm){
  document.getElementById('viewFarmName').textContent=farm.name;
  const statsMap={statAlgae:'algae',statPH:'ph',statDO:'do',statSalinity:'salinity',statBacteria:'bacteria'};
  Object.keys(statsMap).forEach(id=>{
    const el=document.getElementById(id);
    el.textContent=farm[statsMap[id]]||'N/A';
    el.style.opacity=(el.textContent==='N/A')?0.3:1;
  });
  editing=false; editBtn.textContent='Edit';
  document.getElementById('viewModal').style.display='flex';
  setTimeout(()=>document.getElementById('viewModal').classList.add('show'),10);
}

const editBtn=document.getElementById('editBtn');
editBtn.addEventListener('click',()=>{
  const statsMap={statAlgae:'algae',statPH:'ph',statDO:'do',statSalinity:'salinity',statBacteria:'bacteria'};
  const farm=farms[currentFarmIndex];
  if(!editing){
    prevValues={};
    Object.keys(statsMap).forEach(id=>{
      const el=document.getElementById(id);
      prevValues[id]=el.textContent;
      el.innerHTML=`<input type="text" value="${el.textContent==='N/A'?'':el.textContent}">`;
    });
    editBtn.textContent='Save';
    editing=true;
  }else{
    Object.keys(statsMap).forEach(id=>{
      const el=document.getElementById(id);
      const val=el.querySelector('input').value||'N/A';
      el.textContent=val; el.style.opacity=(val==='N/A')?0.3:1;
      farm[statsMap[id]]=val;
    });
    editBtn.textContent='Edit';
    editing=false;
    saveToStorage();
  }
});

document.getElementById('exitButton').addEventListener('click',()=>{
  if(editing){ document.getElementById('exitModal').style.display='flex'; }
  else{ document.getElementById('viewModal').style.display='none'; }
});

document.getElementById('confirmExit').addEventListener('click',()=>{
  const statsMap={statAlgae:'algae',statPH:'ph',statDO:'do',statSalinity:'salinity',statBacteria:'bacteria'};
  const farm=farms[currentFarmIndex];
  Object.keys(statsMap).forEach(id=>{
    const el=document.getElementById(id);
    el.textContent=farm[statsMap[id]]||'N/A';
    el.style.opacity=(el.textContent==='N/A')?0.3:1;
  });
  editing=false; editBtn.textContent='Edit';
  document.getElementById('exitModal').style.display='none';
  document.getElementById('viewModal').style.display='none';
});
document.getElementById('cancelExit').addEventListener('click',()=>{ document.getElementById
('exitModal').style.display='none'; });

renderFarms();
</script>

<audio id="bgMusic0" loop>
  <source src="AquaticAmbience.mp3" type="audio/mp3">
</audio>
<audio id="bgMusic1" loop>
  <source src="ZenGarden.mp3" type="audio/mp3">
</audio>
<audio id="bgMusic2" loop>
  <source src="C418.mp3" type="audio/mp3">
</audio>

<script>
  const tracks = [
    document.getElementById("bgMusic0"),
    document.getElementById("bgMusic1"),
    document.getElementById("bgMusic2")
  ];

  const savedOptions = JSON.parse(localStorage.getItem('options')) || {};
  const musicEnabled = savedOptions.music ?? true;
  let currentTrackIndex = parseInt(savedOptions.track ?? 0);
  const volume = savedOptions.volume ?? 20;

  tracks.forEach(t => {
    t.volume = volume / 100;
    t.pause();
  });

  if (musicEnabled) {
    tracks[currentTrackIndex].play().catch(() => {
      const playOnInteraction = () => {
        tracks[currentTrackIndex].play();
        window.removeEventListener('click', playOnInteraction);
        window.removeEventListener('keydown', playOnInteraction);
      };
      window.addEventListener('click', playOnInteraction);
      window.addEventListener('keydown', playOnInteraction);
    });
  }
</script>

</body>
</html>
