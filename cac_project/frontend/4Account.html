<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Account</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, sans-serif;
  background: linear-gradient(to bottom, #d7faff, #b3e6f5);
  margin: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  position: relative;
  padding-top: 200px;
  overflow: hidden;
}

  :root {
    --fish-width: 320px;
  }

h1 {
  font-size: 5em;
  margin-top: 20px;
  margin-bottom: 30px;
  color: #004e64;
  text-shadow: 0 3px 10px rgba(0,0,0,0.15);
  animation: floatTitle 4s ease-in-out infinite;
}

@keyframes floatTitle {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}

.button-row {
  display: flex;
  gap: 25px;
  margin-bottom: 60px;
}

.btn-account {
  padding: 18px 48px;
  font-size: 1.8em;
  border: none;
  border-radius: 18px;
  background: linear-gradient(to right, #00b4d8, #0096c7);
  color: white;
  cursor: pointer;
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);
  min-width: 250px;    
  text-align: center;
  transition: all 0.3s ease;
  display: inline-block;  
  white-space: nowrap;   
}

.btn-account:hover {
  background: linear-gradient(to right, #48cae4, #00b4d8);
  transform: translateY(-2px);
  box-shadow: 0 8px 18px rgba(0,0,0,0.25);
}

.btn-account:active {
  transform: translateY(1px);
  box-shadow: 0 3px 8px rgba(0,0,0,0.2);
}

.back-button {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 200px;
  padding: 16px 0;
  background-color: rgba(0,0,0,0.65);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 700;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 1000;
  backdrop-filter: blur(4px);
}

.back-button:hover {
  background-color: rgba(0,0,0,0.85);
  transform: scale(1.05);
}

.modal {
  display: none;
  position: fixed;
  z-index: 2000;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

.modal-content {
  background: white;
  padding: 40px 30px;
  border-radius: 16px;
  width: 350px;
  position: relative;
  overflow: hidden;
}

.modal-inner-wrapper {
  overflow: hidden;
  width: 100%;
}

.modal-inner {
  display: flex;
  transition: transform 0.5s ease;
  width: 700px;
}

.modal-box {
  width: 350px;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.modal-box h2 {
  color: #004e64;
  text-align: center;
}

.modal-box input {
  padding: 12px 10px;
  font-size: 16px;
  border-radius: 8px;
  border: 2px solid #00b4d8;
  outline: none;
}

.modal-box button {
  padding: 14px 0;
  font-size: 18px;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  background: linear-gradient(to right, #00b4d8, #0096c7);
  color: white;
  cursor: pointer;
  transition: all 0.2s ease;
  width: 340px;      
  display: block;     
  margin: 10px auto;  
  text-align: center;
}

.modal-box button:hover {
  background: linear-gradient(to right, #48cae4, #00b4d8);
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 6px 14px rgba(0,0,0,0.2);
}

.modal-box button:active {
  transform: translateY(1px) scale(1);
  box-shadow: 0 3px 8px rgba(0,0,0,0.2);
}

.close-modal {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
  color: #004e64;
}

.toggle-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 15px;
  position: relative;
}

.toggle-switch {
  width: 140px;
  height: 50px;
  background: #00b4d8;
  border-radius: 50px;
  position: relative;
  cursor: pointer;
}

.toggle-knob {
  width: 64px;
  height: 46px;
  background: white;
  border-radius: 50px;
  position: absolute;
  top: 2px;
  left: 2px;
  transition: all 0.4s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: #00b4d8;
}

.toggle-switch.active .toggle-knob {
  left: 74px;
  color: #0096c7;
}

.toggle-text-left,
.toggle-text-right {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-weight: bold;
  color: white;
  pointer-events: none;
  font-size: 0.9em;
  opacity: 0;
  transition: opacity 0.4s ease;
}

.toggle-text-left { left: 12px; }
.toggle-text-right { right: 12px; }

.toggle-text-left.show { opacity: 1; }
.toggle-text-right.show { opacity: 1; }

.fish-container {
  position: absolute;
  right: 80px;
  bottom: 250px; 
  display: flex;
  align-items: flex-end;
  gap: 20px;
}

.fish {
  width: var(--fish-width);
  max-width: 100%;
  height: auto;
  position: relative;
  bottom: -120px; 
  filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
  transform-origin: center;
  animation: tailWave 2.2s ease-in-out infinite, swimFloat 5s ease-in-out infinite;
}

@keyframes tailWave {
  0%,100%{transform:rotate(0deg) scale(1);}
  50%{transform:rotate(-0.5deg) scale(1.01);}
}

@keyframes swimFloat {
  0%,100%{transform:translateY(0);}
  25%{transform:translateY(-4px);}
  50%{transform:translateY(-7px);}
  75%{transform:translateY(-3px);}
}

.bubble-wrapper {
  position: absolute;
  bottom: 50px; 
  right: 260px;  
  width: 220px;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0.9;
  transition: opacity 0.5s ease;
}

.bubble-wrapper img {
  width: 100%;
  height: auto;
  display: block;
  filter: drop-shadow(0 6px 12px rgba(0,0,0,0.15));
}

.bubble-text {
  position: absolute;
  top: 41%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 90%;
  text-align: center;
  font-size: 1.2em;
  font-weight: bold;
  color: #004e64;
  line-height: 1.2;
  word-wrap: break-word;
  pointer-events: none;
}

@media (max-width:600px){
  h1{font-size:3em;}
  .btn-account{font-size:1.2em;padding:14px 24px;min-width:120px;}
  .fish-container{right:10px;bottom:60px;}
  .modal-content{width:90%;}
  .modal-inner{width:200%;}
  .modal-box{width:100%;}
}
</style>
</head>
<body>

<h1 id="mainTitle">Account</h1>

<div class="button-row" id="buttonRow">
  <button class="btn-account" id="registerBtn">Register</button>
  <button class="btn-account" id="signInBtnOpen">Sign In</button>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <span class="close-modal" id="closeModal">&times;</span>

    <div class="toggle-container">
      <div class="toggle-switch" id="switch">
        <div class="toggle-knob">Sign Up</div>
        <span class="toggle-text-left show" id="textLeft">Sign Up</span>
        <span class="toggle-text-right" id="textRight">Sign In</span>
      </div>
    </div>

    <div class="modal-inner-wrapper">
      <div class="modal-inner" id="modalInner">
        <div class="modal-box" id="signupBox">
          <h2>Register</h2>
          <input type="text" placeholder="Username..." id="regUsername">
          <input type="email" placeholder="Email..." id="regEmail">
          <input type="password" placeholder="Password..." id="regPassword">
          <button id="createBtn">CREATE!</button>
        </div>

        <div class="modal-box" id="loginBox">
          <h2>Sign In</h2>
          <input type="text" placeholder="Username / Email" id="loginUsername">
          <input type="password" placeholder="Password..." id="loginPassword">
          <button id="loginBtn">Sign In</button>
        </div>

        <div class="modal-box" id="signedInBox" style="display:none; text-align:center;">
          <h2>Welcome!</h2>
          <p>You are now signed in.</p>
          <button onclick="closeSignedIn()">Close</button>
        </div>

      </div>
    </div>
  </div>
</div>

<div class="fish-container">
  <div class="bubble-wrapper" id="bubbleWrapper">
    <img src="https://www.freeiconspng.com/uploads/speech-bubble-png-27.png" alt="speech bubble">
    <div id="fish-speech" class="bubble-text"></div>
  </div>
  <img class="fish" src="https://image2url.com/images/1761783428429-12613f14-e588-4be6-8668-5c76026d6323.png" alt="fish">
</div>

<button class="back-button" onclick="window.history.back()">Back</button>

<audio id="bgMusic0" loop><source src="AquaticAmbience.mp3" type="audio/mp3"></audio>
<audio id="bgMusic1" loop><source src="ZenGarden.mp3" type="audio/mp3"></audio>
<audio id="bgMusic2" loop><source src="C418.mp3" type="audio/mp3"></audio>

<script>
const registerBtn = document.getElementById('registerBtn');
const signInBtnOpen = document.getElementById('signInBtnOpen');
const modal = document.getElementById('modal');
const closeModal = document.getElementById('closeModal');
const toggle = document.getElementById('switch');
const knob = toggle.querySelector('.toggle-knob');
const textLeft = document.getElementById('textLeft');
const textRight = document.getElementById('textRight');
const modalInner = document.getElementById('modalInner');
const signupBox = document.getElementById('signupBox');
const loginBox = document.getElementById('loginBox');
const signedInBox = document.getElementById('signedInBox');

function showModal(box){
  modal.style.display='flex';
  signupBox.style.display = 'flex';
  loginBox.style.display = 'flex';
  signedInBox.style.display = 'none';
  if(box === 'login'){
    toggle.classList.add('active');
    modalInner.style.transform='translateX(-50%)';
    knob.textContent='Sign In';
    textLeft.classList.add('show');
    textRight.classList.remove('show');
  } else {
    toggle.classList.remove('active');
    modalInner.style.transform='translateX(0)';
    knob.textContent='Sign Up';
    textLeft.classList.remove('show');
    textRight.classList.add('show');
  }
}

registerBtn.onclick = () => showModal('signup');
signInBtnOpen.onclick = () => showModal('login');
closeModal.onclick = () => modal.style.display='none';
window.onclick = e => { if(e.target === modal) modal.style.display='none'; };

toggle.addEventListener('click', () => {
  toggle.classList.toggle('active');
  if(toggle.classList.contains('active')){
    modalInner.style.transform='translateX(-50%)';
    knob.textContent='Sign In';
    textLeft.classList.add('show');
    textRight.classList.remove('show');
  } else {
    modalInner.style.transform='translateX(0)';
    knob.textContent='Sign Up';
    textLeft.classList.remove('show');
    textRight.classList.add('show');
  }
});

function closeSignedIn(){
  signedInBox.style.display = 'none';
  modal.style.display='none';
  signupBox.style.display = 'flex';
  loginBox.style.display = 'flex';
}

// Fish Bubble
const bubbleWrapper = document.getElementById("bubbleWrapper");
const fishBubble = document.getElementById("fish-speech");
const phrases = ["Have an account already?", "Sign in!", "glub glub glub", "Welcome back, friend!", "Dive in!"];
let phraseIndex = 0;

function typePhrase(phrase, callback){
  fishBubble.textContent = "";
  let typingIndex = 0;
  const typer = setInterval(()=>{
    fishBubble.textContent += phrase[typingIndex];
    typingIndex++;
    if(typingIndex===phrase.length){
      clearInterval(typer);
      setTimeout(()=>{
        bubbleWrapper.style.opacity = 0.25; 
        setTimeout(callback, 500);
      }, 2000);
    }
  },80);
  bubbleWrapper.style.opacity = 1; 
}

function nextPhrase(){
  phraseIndex = Math.floor(Math.random()*phrases.length);
  typePhrase(phrases[phraseIndex], nextPhrase);
}

nextPhrase();

const tracks = [
  document.getElementById("bgMusic0"),
  document.getElementById("bgMusic1"),
  document.getElementById("bgMusic2")
];

const savedOptions = JSON.parse(localStorage.getItem('options')) || {};
const musicEnabled = savedOptions.music ?? true;
let currentTrackIndex = parseInt(savedOptions.track ?? 0);
const volume = savedOptions.volume ?? 20;

tracks.forEach(t => { t.volume = volume / 100; t.pause(); });

if(musicEnabled){
  tracks[currentTrackIndex].play().catch(()=>{
    const playOnInteraction = ()=>{
      tracks[currentTrackIndex].play();
      window.removeEventListener('click',playOnInteraction);
      window.removeEventListener('keydown',playOnInteraction);
    };
    window.addEventListener('click',playOnInteraction);
    window.addEventListener('keydown',playOnInteraction);
  });
}

const createBtn = document.getElementById('createBtn');
createBtn.onclick = async () => {
  const username = document.getElementById('regUsername').value.trim();
  const email = document.getElementById('regEmail').value.trim();
  const password = document.getElementById('regPassword').value;

  if (!username || !email || !password) {
    alert("Please fill out all fields!");
    return;
  }

  try {
    const res = await fetch("/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, email, password })
    });

    if (!res.ok) {
      const errData = await res.json();
      alert(errData.detail || "Registration failed :(");
      return;
    }

    const data = await res.json();
    alert(data.message || "Account created successfully!");
    
    signupBox.style.display = 'none';
    loginBox.style.display = 'none';
    signedInBox.style.display = 'flex';
    document.getElementById('regUsername').value = "";
    document.getElementById('regEmail').value = "";
    document.getElementById('regPassword').value = "";
  } catch (err) {
    console.error(err);
    alert("Something went wrong during registration :(");
  }
};

const loginBtn = document.getElementById('loginBtn');
loginBtn.onclick = async () => {
  const username = document.getElementById('loginUsername').value.trim();
  const password = document.getElementById('loginPassword').value;

  if (!username || !password) {
    alert("Please fill out all fields!");
    return;
  }

  try {
    const res = await fetch("/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    if (!res.ok) {
      const errData = await res.json();
      alert(errData.detail || "Login failed.");
      return;
    }

    const data = await res.json();
    alert(data.message || "Logged in successfully!");
    
    signupBox.style.display = 'none';
    loginBox.style.display = 'none';
    signedInBox.style.display = 'flex';
    document.getElementById('loginUsername').value = "";
    document.getElementById('loginPassword').value = "";
  } catch (err) {
    console.error(err);
    alert("Something went wrong during login.");
  }
};
</script>
</body>
</html>
